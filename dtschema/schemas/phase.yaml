# SPDX-License-Identifier: BSD-2-Clause
# Copyright 2022 Google LLC
%YAML 1.2
---
$id: http://devicetree.org/schemas/phase.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Boot-phase-specific device nodes

maintainers:
  - Simon Glass <sjg@chromium.org>

patternProperties:
  "^phase-(pre-sram,verify,pre-ram,some-ram,all)$":
    type: boolean
    description: |
      Some programs run in memory-constrained environments yet want to make use
      of device tree.

      The full device tree is often quite large (e.g. 40KB) and cannot fit into
      every phase of the boot process. Even when memory is not a problem, some
      phases may wish to limit which device nodes are present, so as to reduce
      execution time.

      This binding supports adding tags to device tree nodes to allow them to be
      marked according to the phases where they should be included.

      Without any tags, nodes are included only in the final phase, where all
      memory is available. Any untagged nodes are dropped from previous phases
      and are ignored before the final phase is reached.

      The build process produces a separate executable for each phase. It can
      use fdtgrep to drop any nodes which are not needed for a particular build.
      For example, the pre-sram build will drop any nodes which are not marked
      with phase-pre-sram or phase-all tags.

      The available tags are as follows, in order of phase execution:

        phase-pre-sram:
          Enable this node when SRAM is not available. This phase must set up
          some SRAM or cache-as-RAM so it can obtain data/BSS space to use
          during execution.

        phase-verify:
          Enable this node in the verification step, which decides which of the
          available images should be run next.

        phase-pre-ram:
          Enable this node in the phase that sets up SDRAM.

        phase-some-ram:
          Enable this node in the phase that is run after SDRAM is working but
          before all of it is available. Some RAM is available but it is limited
          (e.g. it may be split into two pieces by the location of the running
          program) because the program code is not yet relocated out of the way.

        phase-all:
          Include this node in all phases (for U-Boot see enum u_boot_phase)

      Note that phase builds may drop the tags, since they have served their
      purpose by that point. So when looking at phase-specific device tree files
      you may not see these tags.

      Multiple tags can be used in the same node.

      One complication with fdtgrep is that tags apply only to the node they are
      added to, not to any parents. This means that you often need to add the
      same tag to parent nodes so that any properties needed by the parent
      driver are included. Without that, the parent node may have no properties,
      or may not be bound before relocation (meaning that its child will not be
      bound either). This is for implementation reasons and it may be possible
      to address this in the future.

additionalProperties: true
